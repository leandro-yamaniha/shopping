# JVM Options for Java 21 with ZGC Ultra Low Latency
# Optimized for Spring Boot 3.5.5 and Shopping App Backend
# Date: 2025-08-30

# Heap Memory Configuration
-Xms1g
-Xmx2g

# ZGC Ultra Low Latency (Java 21 Stable)
-XX:+UseZGC
-XX:+UnlockExperimentalVMOptions
-XX:ZCollectionInterval=5
-XX:SoftMaxHeapSize=1800m

# Java 21 Performance Features
-XX:+UseStringDeduplication
-XX:+UseCompressedOops
-XX:+UseCompressedClassPointers

# Virtual Threads (Project Loom - Stable in Java 21)
-Djdk.virtualThreadScheduler.parallelism=16
-Djdk.virtualThreadScheduler.maxPoolSize=256

# Memory Management
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=./heapdumps/
-XX:+ExitOnOutOfMemoryError

# GC Logging and Monitoring
-XX:+PrintGC
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-Xloggc:./logs/gc-java21.log
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=5
-XX:GCLogFileSize=10M

# JFR (Java Flight Recorder) - Enhanced in Java 21
-XX:+FlightRecorder
-XX:StartFlightRecording=duration=300s,filename=./logs/flight-java21.jfr,settings=profile

# Network and Security
-Djava.net.preferIPv4Stack=true
-Djava.security.egd=file:/dev/./urandom
-Dnetworkaddress.cache.ttl=30

# Spring Boot Optimizations
-Dspring.jmx.enabled=false
-Dspring.main.lazy-initialization=false

# Java 21 Specific Optimizations
-XX:+EnableDynamicAgentLoading
-XX:+UnlockDiagnosticVMOptions
-XX:+LogVMOutput
-XX:LogFile=./logs/jvm-java21.log

# Performance Tuning
-server
-XX:+TieredCompilation
-XX:TieredStopAtLevel=4
-XX:+UseNUMA
-XX:+OptimizeStringConcat
